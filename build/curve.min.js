!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof global?i=global:"undefined"!=typeof self&&(i=self),i.hsspCurve=e()}}(function(){return function e(i,t,r){function s(a,o){if(!t[a]){if(!i[a]){var l="function"==typeof require&&require;if(!o&&l)return l(a,!0);if(n)return n(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var c=t[a]={exports:{}};i[a][0].call(c.exports,function(e){var t=i[a][1][e];return s(t?t:e)},c,c.exports,e,i,t,r)}return t[a].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(e,i){var t="";t+="",t+='  	<div id="container">',t+='		<h1 id="title">HSSP CURVE</h1>',t+='		<div id="description">',t+="			Visualize the HSSP curve and impose the BLAST-derived sequence alignments and allow the user to dynamically filter and export the data shown on the graph for better insights.",t+="		</div>",t+="		<br/>",t+="		",t+='		<div id="input_wrapper">',t+='			<div class="row">',t+='				<div class="col-sm-3 nopadding">',t+="					Choose from file:",t+='					<div class="row">',t+='						<div class="input-group">',t+='							<input id="fileToUpload" class="filestyle" type="file" name="fileToUpload">',t+="						</div>",t+="					</div>	 ",t+="				</div>",t+="				",t+='				<div class="col-sm-1 nopadding">				',t+="				</div>				",t+="				",t+='				<div class="col-sm-8 nopadding">',t+="					Content:",t+='					<div class="row">	',t+='						<div class="col-sm-12 nopadding">',t+='							<div class="input-group">',t+='								<textarea class="form-control" id="xmlArea" rows="1" style="width: 100%; margin-top: 0px; margin-bottom: 0px;"></textarea> ',t+="							</div>",t+="						</div>",t+="					</div>",t+='					<div class="row content-buttons">	',t+='						<div class="col-sm-4 nopadding">',t+='							<div class="input-group">',t+='								<button class="form-control" id="show_graph">Extract Graph</button>		',t+="							</div>",t+="						</div>	 ",t+='						<div class="col-sm-2 nopadding">',t+='							<div class="input-group">',t+='								<input type="button" class="form-control" value="Clear" onclick="javascript:eraseText();"> ',t+="							</div>",t+="						</div>						",t+='						<div class="col-sm-6 nopadding">',t+="						</div>	 						",t+="					</div>",t+="				</div>",t+="				",t+="				<br/><br/>",t+='				<p style="display:none">',t+="				Blast Output automatically parsed into JSON:			",t+='				<textarea id="jsonArea" rows="8"></textarea> ',t+="				<br/><br/> ",t+="				</p>",t+="			</div>",t+="		</div>",t+="",t+='		<div class="row">',t+="			<br/>",t+="		</div>",t+="		",t+='		<div class="row filter_wrapper">',t+='			<div class="row">',t+="				<h3>Filters</h3>",t+="			</div>",t+="",t+="<!--",t+='			<div class="filter">',t+='			Show >= 100% <input type="checkbox" id="aboveOrEqualTo100">',t+="			</div>",t+="	  		<br/>",t+="-->	  		",t+='	  		<div class="filter">',t+='				<div class="row">',t+="					",t+='					<div class="col-sm-6 nopadding">',t+='						<div class="row">Filter based on HSSP score:</div>',t+='						<div class="row">',t+='						<div class="col-sm-3">',t+='							<div class="input-group">',t+='								<input style="width: 100%;" class="form-control" type="text" id="from" value="-90">',t+="							</div>",t+="						</div>",t+='						<div class="nopadding col-sm-6">',t+='							<div id="slider-range"></div>',t+="						</div>",t+="",t+='						<div class="col-sm-3">',t+='							<div class="input-group">',t+='								<input style="width: 100%;" class="form-control" type="text" id="to" value="80.5">',t+="							</div>",t+="						</div>",t+="						</div>",t+="					</div>",t+='					<div class="col-sm-1 nopadding">					',t+="					</div>	",t+='					<div class="col-sm-5 nopadding">',t+='						<div class="row">HSSP-curve distance:</div>',t+='						<div class="row hssp_curve_slider">	',t+='							<div class="col-sm-12">		',t+='								<div class="row">	',t+='									<input type="range" name="hssp_curve_value" id="hssp_curve_distance" step="1" value="0" min="-19" max="20">',t+="								</div>	",t+='								<div class="row center">						  	',t+='									<span id="range_value">53</span>',t+="								</div>						  	",t+="							</div>",t+="						</div>",t+="					</div>	",t+="				</div>",t+="			</div>",t+="			<br>",t+="		</div>",t+="",t+='		<div id="placeholder"></div>',t+='		<p style="display:none" id="export">Export:',t+="			<br/>",t+='			<a href="javascript:void(0)" download="below.txt" id="below">Download #elements below the hssp curve</a>',t+="			<br/>",t+='			<a href="javascript:void(0)" download="above.txt" id="above">Download #elements above the hssp curve</a>',t+="		</p>",t+="		<br/><br/><br/><br/><br/><br/>",t+="	</div>";var r=function(){};r.html=t,i.exports=r},{}],"hssp-curve":[function(e,i){var t=e("./content.js"),r=function(e){this.el=e.el,this.el.innerHTML=t.html,this.showDescription="undefined"!=typeof e.showDescription?e.showDescription:!1,this.showTitle="undefined"!=typeof e.showTitle?e.showTitle:!1,this.data=e.data,this.render=function(){function e(){S.highcharts({title:{text:"HSSP Curve"},xAxis:{title:{enabled:!0,text:"number of aligned residues"},floor:0,showLastLabel:!0},yAxis:{title:{text:"% sequence identity"},floor:0,ceiling:100},chart:{zoomType:"xy",spacingTop:60},legend:{layout:"vertical",align:"right",verticalAlign:"top",y:-10,x:-35,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF",borderWidth:1},tooltip:{hideDelay:100,formatter:function(){if("hssp curve"==this.series.name)return!1;if("number"==this.series.name){var e=this.point.id;return e=1==this.point.id?"above":"below",this.point.y+" pairs of proteins "+e+" the hssp curve<br/><br/><i>Click to download</i>"}return"<b>HSSP score: "+this.point.hssp_score.toFixed(2)+"</b><br/>% sequence identity: "+this.point.y.toFixed(2)+"<br/>number of aligned residues: "+this.point.x.toFixed(2)}},series:x}),p=S.highcharts()}function i(){b=0,$("#from").val(m),$("#to").val(g),h=m,f=g,o(),x=jQuery.extend(!0,[],y),n(!1),s(!1),e()}function t(){for(var e,i=x.length-1;i>=0;i--)"hssp curve"===x[i].name&&(e=x[i]);x=jQuery.extend(!0,[],y),x.push(e),s(!0);for(var i=0;i<x.length;i++)"hssp curve"!=p.series[i].name&&"number"!=p.series[i].name&&p.series[i].setData(x[i].data)}function r(e){var i=new Blob([e],{type:"text/plain"});return window.URL.createObjectURL(i)}function s(e){var i=0,t=0,s="",n="",a="# HIT - Name of a BLAST Hit\r\n# IDE - Percent identity in alignment\r\n# LALI - Length of alignment, excluding gaps\r\n# HSSP - HSSP-Distance using formula from B. Rost's HSSP-Paper 1999\r\n###########################################################################\r\n# Parameters:\r\n";n+="###########################################################################\r\n# Pairs of Proteins with hssp score greater then the hssp curve\r\n"+a+"# Minimum HSSP Score:"+(100*w).toFixed(2)+"\r\n# Maximum HSSP Score:"+f+"\r\n",s+="###########################################################################\r\n# Pairs of Proteins with hssp score lower then the hssp curve\r\n"+a+"# Minimum HSSP Score:"+h+"\r\n# Maximum HSSP Score:"+(100*w).toFixed(2)+"\r\n";for(var o=x.length-1;o>=0;o--)if("hssp curve"!=x[o].name)for(var l="###########################################################################\r\n#Q: "+x[o].iteration_name+"\r\n###########################################################################\r\nHIT                                        IDE         LALI            HSSP\r\n",d=0,c=0,v=x[o].data,u=v.length-1;u>=0;u--){var m=v[u].hssp_score;if(h>m||m>f)v.splice(u,1);else{for(var g=v[u].id;g.length<43;)g+=" ";for(var b=v[u].y.toFixed(2)+"";b.length<12;)b+=" ";for(var y=v[u].x+"";y.length<16;)y+=" ";var S=g+b+y+m.toFixed(2)+"\r\n";m>=100*w?(t++,0==d&&(n+=l,d++),n+=S):(i++,0==c&&(s+=l,c++),s+=S)}}var L=[{name:"# above HSSP Curve",id:1,y:t,color:Highcharts.getOptions().colors[0]},{name:"# below HSSP Curve",id:2,y:i,color:Highcharts.getOptions().colors[1]}],j={type:"pie",name:"number",data:L,center:[20,"-22%"],size:70,showInLegend:!1,dataLabels:{enabled:!1},events:{click:function(e){if(1==e.point.id){var i=document.getElementById("above");i.click()}else{var t=document.getElementById("below");t.click()}}}};if(x.push(j),e)for(var o=0;o<p.series.length;o++)p.series[o].name==j.name&&p.series[o].setData(L);var I=document.getElementById("above");window.URL.revokeObjectURL(_),window.URL.revokeObjectURL(H),_=r(n),I.href=_;var P=document.getElementById("below");H=r(s),P.href=H,$("#below").html("Download "+i+" pairs of proteins below the hssp curve"),$("#above").html("Download "+t+" pairs of proteins above the hssp curve")}function n(e){var i=[];for(L=0;L<=b;L+=8){var t=[],r=0;if(L<=11)t.push(L),r=1+w,t.push(100*r);else if(L<=450){var r=480*Math.pow(L,-.32*(1+Math.exp(-L/1e3)))/100+w;t.push(L),t.push(100*r)}else t.push(L),r=.195+w,t.push(100*r);1>!r&&i.push(t)}var s={};if(s.name="hssp curve",s.data=i,s.lineWidth=2,s.marker={radius:0},s.pointStart=0,x.push(s),e)for(var n=0;n<p.series.length;n++)p.series[n].name==s.name&&p.series[n].setData(i)}function a(e){var i;return i=window.ActiveXObject?e.xml:(new XMLSerializer).serializeToString(e)}function o(){y=[];var e=JSON.stringify(j.xml_str2json($("#xmlArea").val()));$("#jsonArea").val(e),e=jQuery.parseJSON(e);var i=e.BlastOutput.BlastOutput_iterations,t=1;$.isArray(i.Iteration)?$.each(i.Iteration,function(e,i){l(i,t),t++}):l(i.Iteration,t)}function l(e,i){var t=e["Iteration_query-def"],r=e.Iteration_hits.Hit,s=[];if($.isArray(r))$.each(r,function(e,i){var t=i.Hit_hsps.Hsp,r=d(i,t);jQuery.isEmptyObject(r)||s.push(r)});else{var n=r.Hit_hsps.Hsp,a=d(r,n);jQuery.isEmptyObject(a)||s.push(a)}var o={};o.name="Iteration "+i,o.iteration_name=t,o.data=s,o.type="scatter",o.marker={radius:2,states:{hover:{enabled:!0,lineColor:"rgb(100,100,100)"}}},o.satates={hover:{marker:{enabled:!1}}},o.pointStart=0,y.push(o)}function d(e,i){if($.isArray(i)){var t=[];$.each(i,function(i,r){var s=c(e,r);jQuery.isEmptyObject(s)||t.push(s)});for(var r,s=0;s<t.length;s++)jQuery.isEmptyObject(r)?r=t[s]:t[s].hssp_score>r.hssp_score&&(r=t[s]);return r}return c(e,i)}function c(e,i){var t=parseInt(i["Hsp_align-len"])-i.Hsp_gaps,r=(e.Hit_num,e.Hit_id),s=parseInt(i.Hsp_identity),n=100*s/t,a=0;a=11>=t?n-100:450>=t?n-480*Math.pow(t,-.32*(1+Math.exp(-t/1e3))):n-19.5;var o=s/t,l={};return o>1?l:(t>b&&(b=t),l.x=parseInt(t),l.y=100*o,l.hssp_score=a,l.id=r,l)}function v(e){var t=a(e);$("#xmlArea").val(t),i()}function u(){h=$("#from").val(),f=$("#to").val(),t()}var p,h=null,f=null,m=-90,g=80.5,b=0,w=0,y=[],x=[],S=$("#placeholder");0==this.showTitle&&$(this.el).find("#title").hide(),0==this.showDescription&&$(this.el).find("#description").hide(),document.getElementById("fileToUpload").onchange=function(){var e=this.files[0],t=new FileReader;t.onload=function(){$("#xmlArea").val(this.result),i()},t.readAsText(e)};var _,H;$.ajax({url:this.data,method:"GET",dataType:"xml",success:v});var j=new X2JS;$("#show_graph").click(function(){i()}),$("#hssp_curve_distance").mousemove(function(){$("#range_value").html(parseInt($(this).val()))}),$("#hssp_curve_distance").change(function(){$(this).next().html(parseInt($(this).val())),w=$(this).val()/100,x=jQuery.extend(!0,[],y),n(!0),s(!0)}),$(":file").filestyle(),$("#slider-range").slider({range:!0,min:-90,max:80.5,values:[-90,80.5],slide:function(e,i){$("#from").val(i.values[0]),$("#to").val(i.values[1]),u()}}),$("#to").keyup(function(){var e=$("#to").val();e>80.5&&$("#to").val(80.5),u()}),$("#from").keyup(function(){var e=$("#from").val();-90>e&&$("#from").val(-90),u()})}};i.exports=r},{"./content.js":1}]},{},["hssp-curve"])("hssp-curve")});