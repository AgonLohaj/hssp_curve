!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.hsspCurve=e()}}(function(){return function e(t,i,r){function s(a,o){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!o&&l)return l(a,!0);if(n)return n(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var c=i[a]={exports:{}};t[a][0].call(c.exports,function(e){var i=t[a][1][e];return s(i?i:e)},c,c.exports,e,t,i,r)}return i[a].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(e,t){var i="";i+="",i+='  	<div id="container">',i+="		<h1>HSSP CURVE</h1>",i+='		<div id="description">',i+="			Visualize the HSSP curve and impose the BLAST-derived sequence alignments and allow the user to dynamically filter and export the data shown on the graph for better insights.",i+="		</div>",i+="		<br/>",i+="		",i+='		<div id="input_wrapper">',i+='			<div class="row">',i+='				<div class="col-sm-3 nopadding">',i+="					Choose from file:",i+='					<div class="row">',i+='						<div class="input-group">',i+='							<input id="fileToUpload" class="filestyle" type="file" name="fileToUpload">',i+="						</div>",i+="					</div>	 ",i+="				</div>",i+="				",i+='				<div class="col-sm-1 nopadding">				',i+="				</div>				",i+="				",i+='				<div class="col-sm-8 nopadding">',i+="					Content:",i+='					<div class="row">	',i+='						<div class="col-sm-10 nopadding">',i+='							<div class="input-group">',i+='								<textarea class="form-control" id="xmlArea" rows="1" style="width: 100%; margin-top: 0px; margin-bottom: 0px;"></textarea> ',i+="							</div>",i+="						</div>",i+='						<div class="col-sm-2 nopadding">',i+='							<div class="input-group">',i+='								<input type="button" class="form-control" value="Clear" onclick="javascript:eraseText();"> ',i+="							</div>",i+="						</div>						",i+="					</div>",i+='					<div class="row">	',i+='						<div class="col-sm-4 nopadding">',i+="						</div>	 					",i+='						<div class="col-sm-4 nopadding">',i+='							<div class="input-group">',i+='								<button class="form-control" id="show_graph">Extract Graph</button>		',i+="							</div>",i+="						</div>	 ",i+='						<div class="col-sm-4 nopadding">',i+="						</div>	 						",i+="					</div>",i+="				</div>",i+="				",i+="				<br/><br/>",i+='				<p style="display:none">',i+="				Blast Output automatically parsed into JSON:			",i+='				<textarea id="jsonArea" rows="8"></textarea> ',i+="				<br/><br/> ",i+="				</p>",i+="			</div>",i+="		</div>",i+="",i+='		<div class="row">',i+="			<br/>",i+="		</div>",i+="		",i+='		<div class="row filter_wrapper">',i+='			<div class="row">',i+="				<h3>Filters</h3>",i+="			</div>",i+="",i+="<!--",i+='			<div class="filter">',i+='			Show >= 100% <input type="checkbox" id="aboveOrEqualTo100">',i+="			</div>",i+="	  		<br/>",i+="-->	  		",i+='	  		<div class="filter">',i+='				<div class="row">',i+="					",i+='					<div class="col-sm-6 nopadding">',i+='						<div class="row">Filter based on HSSP score:</div>',i+='						<div class="row">',i+='						<div class="col-sm-3">',i+='							<div class="input-group">',i+='								<input style="width: 100%;" class="form-control" type="text" id="from" value="-90">',i+="							</div>",i+="						</div>",i+='						<div class="nopadding col-sm-6">',i+='							<div id="slider-range"></div>',i+="						</div>",i+="",i+='						<div class="col-sm-3">',i+='							<div class="input-group">',i+='								<input style="width: 100%;" class="form-control" type="text" id="to" value="80.5">',i+="							</div>",i+="						</div>",i+="						</div>",i+="					</div>",i+='					<div class="col-sm-1 nopadding">					',i+="					</div>	",i+='					<div class="col-sm-5 nopadding">',i+='						<div class="row">HSSP-curve distance:</div>',i+='						<div class="row hssp_curve_slider">	',i+='							<div class="col-sm-12">		',i+='								<div class="row">	',i+='									<input type="range" name="hssp_curve_value" id="hssp_curve_distance" step="1" value="0" min="-19" max="20">',i+="								</div>	",i+='								<div class="row center">						  	',i+='									<span id="range_value">53</span>',i+="								</div>						  	",i+="							</div>",i+="						</div>",i+="					</div>	",i+="				</div>",i+="			</div>",i+="			<br>",i+="		</div>",i+="",i+='		<div id="placeholder"></div>',i+='		<p style="display:none" id="export">Export:',i+="			<br/>",i+='			<a href="javascript:void(0)" download="below.txt" id="below">Download #elements below the hssp curve</a>',i+="			<br/>",i+='			<a href="javascript:void(0)" download="above.txt" id="above">Download #elements above the hssp curve</a>',i+="		</p>",i+="		<br/>		<br/>		<br/>		<br/>",i+='		<div id="more_information">',i+='			The current implementation works with Blast output version BLASTP 2.2.29+. The input loaded here by default come from a sample output which may contain bad data so, for better understanding use your own alignment result. For generating the alignment output, you can use <a href="http://blast.ncbi.nlm.nih.gov/Blast.cgi">BLAST</a>.<br/>The algorithm for calculating HSSP Curve and HSSP Values is referenced from this <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC169026/?report=classic">paper</a>.<br/>',i+="			<br/>Features:",i+="			<br/>&nbsp;&nbsp;&nbsp;&nbsp;Ability to filter based on hssp scores",i+="			<br/>&nbsp;&nbsp;&nbsp;&nbsp;Ability to zoom by selecting a part of the graph",i+="			<br/>&nbsp;&nbsp;&nbsp;&nbsp;Ability to download a screenshot of the graph or print it",i+="			<br/>&nbsp;&nbsp;&nbsp;&nbsp;Ability to download all the elements that are below or above the hssp curve in .txt format (hint: check out the pie chart)",i+="			<br/>&nbsp;&nbsp;&nbsp;&nbsp;Ability to show/hide different data from the legend of the graph",i+="			<br/>&nbsp;&nbsp;&nbsp;&nbsp;Ability to define the distance from the hssp curve (0 being the original hssp curve)",i+="		</div>",i+="		<br/><br/><br/><br/><br/><br/>",i+="	</div>";var r=function(){};r.html=i,t.exports=r},{}],"hssp-curve":[function(e,t){var i=e("./content.js"),r=function(e){this.el=e.el,this.el.innerHTML=i.html,this.asd="asd",this.render=function(){function e(){S.highcharts({title:{text:"HSSP Curve"},xAxis:{title:{enabled:!0,text:"number of aligned residues"},floor:0,showLastLabel:!0},yAxis:{title:{text:"% sequence identity"},floor:0,ceiling:100},chart:{zoomType:"xy",spacingTop:60},legend:{layout:"vertical",align:"right",verticalAlign:"top",y:-10,x:-35,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF",borderWidth:1},tooltip:{hideDelay:100,formatter:function(){if("hssp curve"==this.series.name)return!1;if("number"==this.series.name){var e=this.point.id;return e=1==this.point.id?"above":"below",this.point.y+" pairs of proteins "+e+" the hssp curve<br/><br/><i>Click to download</i>"}return"<b>HSSP score: "+this.point.hssp_score.toFixed(2)+"</b><br/>% sequence identity: "+this.point.y.toFixed(2)+"<br/>number of aligned residues: "+this.point.x.toFixed(2)}},series:x}),u=S.highcharts()}function t(){g=0,$("#from").val(m),$("#to").val(b),h=m,f=b,o(),x=jQuery.extend(!0,[],w),n(!1),s(!1),e()}function i(){for(var e,t=x.length-1;t>=0;t--)"hssp curve"===x[t].name&&(e=x[t]);x=jQuery.extend(!0,[],w),x.push(e),s(!0);for(var t=0;t<x.length;t++)"hssp curve"!=u.series[t].name&&"number"!=u.series[t].name&&u.series[t].setData(x[t].data)}function r(e){var t=new Blob([e],{type:"text/plain"});return window.URL.createObjectURL(t)}function s(e){var t=0,i=0,s="",n="",a="# HIT - Name of a BLAST Hit\r\n# IDE - Percent identity in alignment\r\n# LALI - Length of alignment, excluding gaps\r\n# HSSP - HSSP-Distance using formula from B. Rost's HSSP-Paper 1999\r\n###########################################################################\r\n# Parameters:\r\n";n+="###########################################################################\r\n# Pairs of Proteins with hssp score greater then the hssp curve\r\n"+a+"# Minimum HSSP Score:"+(100*y).toFixed(2)+"\r\n# Maximum HSSP Score:"+f+"\r\n",s+="###########################################################################\r\n# Pairs of Proteins with hssp score lower then the hssp curve\r\n"+a+"# Minimum HSSP Score:"+h+"\r\n# Maximum HSSP Score:"+(100*y).toFixed(2)+"\r\n";for(var o=x.length-1;o>=0;o--)if("hssp curve"!=x[o].name)for(var l="###########################################################################\r\n#Q: "+x[o].iteration_name+"\r\n###########################################################################\r\nHIT                                        IDE         LALI            HSSP\r\n",d=0,c=0,p=x[o].data,v=p.length-1;v>=0;v--){var m=p[v].hssp_score;if(h>m||m>f)p.splice(v,1);else{for(var b=p[v].id;b.length<43;)b+=" ";for(var g=p[v].y.toFixed(2)+"";g.length<12;)g+=" ";for(var w=p[v].x+"";w.length<16;)w+=" ";var S=b+g+w+m.toFixed(2)+"\r\n";m>=100*y?(i++,0==d&&(n+=l,d++),n+=S):(t++,0==c&&(s+=l,c++),s+=S)}}var L=[{name:"# above HSSP Curve",id:1,y:i,color:Highcharts.getOptions().colors[0]},{name:"# below HSSP Curve",id:2,y:t,color:Highcharts.getOptions().colors[1]}],P={type:"pie",name:"number",data:L,center:[20,"-22%"],size:70,showInLegend:!1,dataLabels:{enabled:!1},events:{click:function(e){if(1==e.point.id){var t=document.getElementById("above");t.click()}else{var i=document.getElementById("below");i.click()}}}};if(x.push(P),e)for(var o=0;o<u.series.length;o++)u.series[o].name==P.name&&u.series[o].setData(L);var j=document.getElementById("above");window.URL.revokeObjectURL(_),window.URL.revokeObjectURL(H),_=r(n),j.href=_;var A=document.getElementById("below");H=r(s),A.href=H,$("#below").html("Download "+t+" pairs of proteins below the hssp curve"),$("#above").html("Download "+i+" pairs of proteins above the hssp curve")}function n(e){var t=[];for(L=0;L<=g;L+=8){var i=[],r=0;if(L<=11)i.push(L),r=1+y,i.push(100*r);else if(L<=450){var r=480*Math.pow(L,-.32*(1+Math.exp(-L/1e3)))/100+y;i.push(L),i.push(100*r)}else i.push(L),r=.195+y,i.push(100*r);1>!r&&t.push(i)}var s={};if(s.name="hssp curve",s.data=t,s.lineWidth=2,s.marker={radius:0},s.pointStart=0,x.push(s),e)for(var n=0;n<u.series.length;n++)u.series[n].name==s.name&&u.series[n].setData(t)}function a(e){var t;return t=window.ActiveXObject?e.xml:(new XMLSerializer).serializeToString(e)}function o(){w=[];var e=JSON.stringify(P.xml_str2json($("#xmlArea").val()));$("#jsonArea").val(e),e=jQuery.parseJSON(e);var t=e.BlastOutput.BlastOutput_iterations,i=1;$.isArray(t.Iteration)?$.each(t.Iteration,function(e,t){l(t,i),i++}):l(t.Iteration,i)}function l(e,t){var i=e["Iteration_query-def"],r=e.Iteration_hits.Hit,s=[];if($.isArray(r))$.each(r,function(e,t){var i=t.Hit_hsps.Hsp,r=d(t,i);jQuery.isEmptyObject(r)||s.push(r)});else{var n=r.Hit_hsps.Hsp,a=d(r,n);jQuery.isEmptyObject(a)||s.push(a)}var o={};o.name="Iteration "+t,o.iteration_name=i,o.data=s,o.type="scatter",o.marker={radius:2,states:{hover:{enabled:!0,lineColor:"rgb(100,100,100)"}}},o.satates={hover:{marker:{enabled:!1}}},o.pointStart=0,w.push(o)}function d(e,t){if($.isArray(t)){var i=[];$.each(t,function(t,r){var s=c(e,r);jQuery.isEmptyObject(s)||i.push(s)});for(var r,s=0;s<i.length;s++)jQuery.isEmptyObject(r)?r=i[s]:i[s].hssp_score>r.hssp_score&&(r=i[s]);return r}return c(e,t)}function c(e,t){var i=parseInt(t["Hsp_align-len"])-t.Hsp_gaps,r=(e.Hit_num,e.Hit_id),s=parseInt(t.Hsp_identity),n=100*s/i,a=0;a=11>=i?n-100:450>=i?n-480*Math.pow(i,-.32*(1+Math.exp(-i/1e3))):n-19.5;var o=s/i,l={};return o>1?l:(i>g&&(g=i),l.x=parseInt(i),l.y=100*o,l.hssp_score=a,l.id=r,l)}function p(e){var i=a(e);$("#xmlArea").val(i),t()}function v(){h=$("#from").val(),f=$("#to").val(),i()}var u,h=null,f=null,m=-90,b=80.5,g=0,y=0,w=[],x=[],S=$("#placeholder");document.getElementById("fileToUpload").onchange=function(){var e=this.files[0],i=new FileReader;i.onload=function(){$("#xmlArea").val(this.result),t()},i.readAsText(e)};var _,H;$.ajax({url:"data/single.xml",method:"GET",dataType:"xml",success:p});var P=new X2JS;$("#show_graph").click(function(){t()}),$("#hssp_curve_distance").mousemove(function(){$("#range_value").html(parseInt($(this).val()))}),$("#hssp_curve_distance").change(function(){$(this).next().html(parseInt($(this).val())),y=$(this).val()/100,x=jQuery.extend(!0,[],w),n(!0),s(!0)}),$(":file").filestyle(),$("#slider-range").slider({range:!0,min:-90,max:80.5,values:[-90,80.5],slide:function(e,t){$("#from").val(t.values[0]),$("#to").val(t.values[1]),v()}}),$("#to").keyup(function(){var e=$("#to").val();e>80.5&&$("#to").val(80.5),v()}),$("#from").keyup(function(){var e=$("#from").val();-90>e&&$("#from").val(-90),v()})}};t.exports=r},{"./content.js":1}]},{},["hssp-curve"])("hssp-curve")});