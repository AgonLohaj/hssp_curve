!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.hsspCurve=e()}}(function(){return function e(t,r,i){function n(a,o){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!o&&l)return l(a,!0);if(s)return s(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var c=r[a]={exports:{}};t[a][0].call(c.exports,function(e){var r=t[a][1][e];return n(r?r:e)},c,c.exports,e,t,r,i)}return r[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(e,t){var r="";r+="",r+='  	<div id="container">',r+="		<h1>HSSP CURVE</h1>",r+='		<div id="description">',r+="			Visualize the HSSP curve and impose the BLAST-derived sequence alignments and allow the user to dynamically filter and export the data shown on the graph for better insights.",r+="		</div>",r+="		<br/>",r+="		",r+='		<div id="input_wrapper">',r+='			<div class="row">',r+='				<div class="col-sm-3 nopadding">',r+="					Choose from file:",r+='					<div class="row">',r+='						<div class="input-group">',r+='							<input id="fileToUpload" class="filestyle" type="file" name="fileToUpload">',r+="						</div>",r+="					</div>	 ",r+="				</div>",r+="				",r+='				<div class="col-sm-1 nopadding">				',r+="				</div>				",r+="				",r+='				<div class="col-sm-8 nopadding">',r+="					Content:",r+='					<div class="row">	',r+='						<div class="col-sm-12 nopadding">',r+='							<div class="input-group">',r+='								<textarea class="form-control" id="xmlArea" rows="1" style="width: 100%; margin-top: 0px; margin-bottom: 0px;"></textarea> ',r+="							</div>",r+="						</div>",r+="					</div>",r+='					<div class="row content-buttons">	',r+='						<div class="col-sm-4 nopadding">',r+='							<div class="input-group">',r+='								<button class="form-control" id="show_graph">Extract Graph</button>		',r+="							</div>",r+="						</div>	 ",r+='						<div class="col-sm-2 nopadding">',r+='							<div class="input-group">',r+='								<input type="button" class="form-control" value="Clear" onclick="javascript:eraseText();"> ',r+="							</div>",r+="						</div>						",r+='						<div class="col-sm-6 nopadding">',r+="						</div>	 						",r+="					</div>",r+="				</div>",r+="				",r+="				<br/><br/>",r+='				<p style="display:none">',r+="				Blast Output automatically parsed into JSON:			",r+='				<textarea id="jsonArea" rows="8"></textarea> ',r+="				<br/><br/> ",r+="				</p>",r+="			</div>",r+="		</div>",r+="",r+='		<div class="row">',r+="			<br/>",r+="		</div>",r+="		",r+='		<div class="row filter_wrapper">',r+='			<div class="row">',r+="				<h3>Filters</h3>",r+="			</div>",r+="",r+="<!--",r+='			<div class="filter">',r+='			Show >= 100% <input type="checkbox" id="aboveOrEqualTo100">',r+="			</div>",r+="	  		<br/>",r+="-->	  		",r+='	  		<div class="filter">',r+='				<div class="row">',r+="					",r+='					<div class="col-sm-6 nopadding">',r+='						<div class="row">Filter based on HSSP score:</div>',r+='						<div class="row">',r+='						<div class="col-sm-3">',r+='							<div class="input-group">',r+='								<input style="width: 100%;" class="form-control" type="text" id="from" value="-90">',r+="							</div>",r+="						</div>",r+='						<div class="nopadding col-sm-6">',r+='							<div id="slider-range"></div>',r+="						</div>",r+="",r+='						<div class="col-sm-3">',r+='							<div class="input-group">',r+='								<input style="width: 100%;" class="form-control" type="text" id="to" value="80.5">',r+="							</div>",r+="						</div>",r+="						</div>",r+="					</div>",r+='					<div class="col-sm-1 nopadding">					',r+="					</div>	",r+='					<div class="col-sm-5 nopadding">',r+='						<div class="row">HSSP-curve distance:</div>',r+='						<div class="row hssp_curve_slider">	',r+='							<div class="col-sm-12">		',r+='								<div class="row">	',r+='									<input type="range" name="hssp_curve_value" id="hssp_curve_distance" step="1" value="0" min="-19" max="20">',r+="								</div>	",r+='								<div class="row center">						  	',r+='									<span id="range_value">53</span>',r+="								</div>						  	",r+="							</div>",r+="						</div>",r+="					</div>	",r+="				</div>",r+="			</div>",r+="			<br>",r+="		</div>",r+="",r+='		<div id="placeholder"></div>',r+='		<p style="display:none" id="export">Export:',r+="			<br/>",r+='			<a href="javascript:void(0)" download="below.txt" id="below">Download #elements below the hssp curve</a>',r+="			<br/>",r+='			<a href="javascript:void(0)" download="above.txt" id="above">Download #elements above the hssp curve</a>',r+="		</p>",r+="		<br/>		<br/>		<br/>		<br/>",r+='		<div id="more_information">',r+='			The current implementation works with Blast output version BLASTP 2.2.29+. The input loaded here by default come from a sample output which may contain bad data so, for better understanding use your own alignment result. For generating the alignment output, you can use <a href="http://blast.ncbi.nlm.nih.gov/Blast.cgi">BLAST</a>.<br/>The algorithm for calculating HSSP Curve and HSSP Values is referenced from this <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC169026/?report=classic">paper</a>.<br/>',r+="			<br/>Features:",r+="			<br/>&nbsp;&nbsp;&nbsp;&nbsp;Ability to filter based on hssp scores",r+="			<br/>&nbsp;&nbsp;&nbsp;&nbsp;Ability to zoom by selecting a part of the graph",r+="			<br/>&nbsp;&nbsp;&nbsp;&nbsp;Ability to download a screenshot of the graph or print it",r+="			<br/>&nbsp;&nbsp;&nbsp;&nbsp;Ability to download all the elements that are below or above the hssp curve in .txt format (hint: check out the pie chart)",r+="			<br/>&nbsp;&nbsp;&nbsp;&nbsp;Ability to show/hide different data from the legend of the graph",r+="			<br/>&nbsp;&nbsp;&nbsp;&nbsp;Ability to define the distance from the hssp curve (0 being the original hssp curve)",r+="		</div>",r+="		<br/><br/><br/><br/><br/><br/>",r+="	</div>";var i=function(){};i.html=r,t.exports=i},{}],"hssp-curve":[function(e,t){var r=e("./content.js"),i=function(e){this.el=e.el,this.el.innerHTML=r.html,this.data=e.data,this.render=function(){function e(){S.highcharts({title:{text:"HSSP Curve"},xAxis:{title:{enabled:!0,text:"number of aligned residues"},floor:0,showLastLabel:!0},yAxis:{title:{text:"% sequence identity"},floor:0,ceiling:100},chart:{zoomType:"xy",spacingTop:60},legend:{layout:"vertical",align:"right",verticalAlign:"top",y:-10,x:-35,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF",borderWidth:1},tooltip:{hideDelay:100,formatter:function(){if("hssp curve"==this.series.name)return!1;if("number"==this.series.name){var e=this.point.id;return e=1==this.point.id?"above":"below",this.point.y+" pairs of proteins "+e+" the hssp curve<br/><br/><i>Click to download</i>"}return"<b>HSSP score: "+this.point.hssp_score.toFixed(2)+"</b><br/>% sequence identity: "+this.point.y.toFixed(2)+"<br/>number of aligned residues: "+this.point.x.toFixed(2)}},series:x}),u=S.highcharts()}function t(){g=0,$("#from").val(m),$("#to").val(b),h=m,f=b,o(),x=jQuery.extend(!0,[],w),s(!1),n(!1),e()}function r(){for(var e,t=x.length-1;t>=0;t--)"hssp curve"===x[t].name&&(e=x[t]);x=jQuery.extend(!0,[],w),x.push(e),n(!0);for(var t=0;t<x.length;t++)"hssp curve"!=u.series[t].name&&"number"!=u.series[t].name&&u.series[t].setData(x[t].data)}function i(e){var t=new Blob([e],{type:"text/plain"});return window.URL.createObjectURL(t)}function n(e){var t=0,r=0,n="",s="",a="# HIT - Name of a BLAST Hit\r\n# IDE - Percent identity in alignment\r\n# LALI - Length of alignment, excluding gaps\r\n# HSSP - HSSP-Distance using formula from B. Rost's HSSP-Paper 1999\r\n###########################################################################\r\n# Parameters:\r\n";s+="###########################################################################\r\n# Pairs of Proteins with hssp score greater then the hssp curve\r\n"+a+"# Minimum HSSP Score:"+(100*y).toFixed(2)+"\r\n# Maximum HSSP Score:"+f+"\r\n",n+="###########################################################################\r\n# Pairs of Proteins with hssp score lower then the hssp curve\r\n"+a+"# Minimum HSSP Score:"+h+"\r\n# Maximum HSSP Score:"+(100*y).toFixed(2)+"\r\n";for(var o=x.length-1;o>=0;o--)if("hssp curve"!=x[o].name)for(var l="###########################################################################\r\n#Q: "+x[o].iteration_name+"\r\n###########################################################################\r\nHIT                                        IDE         LALI            HSSP\r\n",d=0,c=0,p=x[o].data,v=p.length-1;v>=0;v--){var m=p[v].hssp_score;if(h>m||m>f)p.splice(v,1);else{for(var b=p[v].id;b.length<43;)b+=" ";for(var g=p[v].y.toFixed(2)+"";g.length<12;)g+=" ";for(var w=p[v].x+"";w.length<16;)w+=" ";var S=b+g+w+m.toFixed(2)+"\r\n";m>=100*y?(r++,0==d&&(s+=l,d++),s+=S):(t++,0==c&&(n+=l,c++),n+=S)}}var L=[{name:"# above HSSP Curve",id:1,y:r,color:Highcharts.getOptions().colors[0]},{name:"# below HSSP Curve",id:2,y:t,color:Highcharts.getOptions().colors[1]}],P={type:"pie",name:"number",data:L,center:[20,"-22%"],size:70,showInLegend:!1,dataLabels:{enabled:!1},events:{click:function(e){if(1==e.point.id){var t=document.getElementById("above");t.click()}else{var r=document.getElementById("below");r.click()}}}};if(x.push(P),e)for(var o=0;o<u.series.length;o++)u.series[o].name==P.name&&u.series[o].setData(L);var j=document.getElementById("above");window.URL.revokeObjectURL(_),window.URL.revokeObjectURL(H),_=i(s),j.href=_;var A=document.getElementById("below");H=i(n),A.href=H,$("#below").html("Download "+t+" pairs of proteins below the hssp curve"),$("#above").html("Download "+r+" pairs of proteins above the hssp curve")}function s(e){var t=[];for(L=0;L<=g;L+=8){var r=[],i=0;if(L<=11)r.push(L),i=1+y,r.push(100*i);else if(L<=450){var i=480*Math.pow(L,-.32*(1+Math.exp(-L/1e3)))/100+y;r.push(L),r.push(100*i)}else r.push(L),i=.195+y,r.push(100*i);1>!i&&t.push(r)}var n={};if(n.name="hssp curve",n.data=t,n.lineWidth=2,n.marker={radius:0},n.pointStart=0,x.push(n),e)for(var s=0;s<u.series.length;s++)u.series[s].name==n.name&&u.series[s].setData(t)}function a(e){var t;return t=window.ActiveXObject?e.xml:(new XMLSerializer).serializeToString(e)}function o(){w=[];var e=JSON.stringify(P.xml_str2json($("#xmlArea").val()));$("#jsonArea").val(e),e=jQuery.parseJSON(e);var t=e.BlastOutput.BlastOutput_iterations,r=1;$.isArray(t.Iteration)?$.each(t.Iteration,function(e,t){l(t,r),r++}):l(t.Iteration,r)}function l(e,t){var r=e["Iteration_query-def"],i=e.Iteration_hits.Hit,n=[];if($.isArray(i))$.each(i,function(e,t){var r=t.Hit_hsps.Hsp,i=d(t,r);jQuery.isEmptyObject(i)||n.push(i)});else{var s=i.Hit_hsps.Hsp,a=d(i,s);jQuery.isEmptyObject(a)||n.push(a)}var o={};o.name="Iteration "+t,o.iteration_name=r,o.data=n,o.type="scatter",o.marker={radius:2,states:{hover:{enabled:!0,lineColor:"rgb(100,100,100)"}}},o.satates={hover:{marker:{enabled:!1}}},o.pointStart=0,w.push(o)}function d(e,t){if($.isArray(t)){var r=[];$.each(t,function(t,i){var n=c(e,i);jQuery.isEmptyObject(n)||r.push(n)});for(var i,n=0;n<r.length;n++)jQuery.isEmptyObject(i)?i=r[n]:r[n].hssp_score>i.hssp_score&&(i=r[n]);return i}return c(e,t)}function c(e,t){var r=parseInt(t["Hsp_align-len"])-t.Hsp_gaps,i=(e.Hit_num,e.Hit_id),n=parseInt(t.Hsp_identity),s=100*n/r,a=0;a=11>=r?s-100:450>=r?s-480*Math.pow(r,-.32*(1+Math.exp(-r/1e3))):s-19.5;var o=n/r,l={};return o>1?l:(r>g&&(g=r),l.x=parseInt(r),l.y=100*o,l.hssp_score=a,l.id=i,l)}function p(e){var r=a(e);$("#xmlArea").val(r),t()}function v(){h=$("#from").val(),f=$("#to").val(),r()}var u,h=null,f=null,m=-90,b=80.5,g=0,y=0,w=[],x=[],S=$("#placeholder");document.getElementById("fileToUpload").onchange=function(){var e=this.files[0],r=new FileReader;r.onload=function(){$("#xmlArea").val(this.result),t()},r.readAsText(e)};var _,H;$.ajax({url:this.data,method:"GET",dataType:"xml",success:p});var P=new X2JS;$("#show_graph").click(function(){t()}),$("#hssp_curve_distance").mousemove(function(){$("#range_value").html(parseInt($(this).val()))}),$("#hssp_curve_distance").change(function(){$(this).next().html(parseInt($(this).val())),y=$(this).val()/100,x=jQuery.extend(!0,[],w),s(!0),n(!0)}),$(":file").filestyle(),$("#slider-range").slider({range:!0,min:-90,max:80.5,values:[-90,80.5],slide:function(e,t){$("#from").val(t.values[0]),$("#to").val(t.values[1]),v()}}),$("#to").keyup(function(){var e=$("#to").val();e>80.5&&$("#to").val(80.5),v()}),$("#from").keyup(function(){var e=$("#from").val();-90>e&&$("#from").val(-90),v()})}};t.exports=i},{"./content.js":1}]},{},["hssp-curve"])("hssp-curve")});